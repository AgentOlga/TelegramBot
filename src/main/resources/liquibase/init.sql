-- liquibase formatted sql

-- changeset aleksey:1
DROP TABLE IF EXISTS users;
CREATE TABLE users
(
    id            BIGINT generated by default as identity primary key,
    user_id       BIGINT   NOT NULL,
    telegram_nick TEXT,
    first_name    TEXT,
    last_name     TEXT,
    phone_number  TEXT,
    car_number    TEXT,
    email         TEXT,
    address       TEXT,
    shelter_type  SMALLINT,-- enum ShelterType
    user_type     SMALLINT NOT NULL,-- enum UserType
    user_status   SMALLINT NOT NULL -- enum UserStatus
);

DROP TABLE IF EXISTS animals;
CREATE TABLE animals
(
    id        BIGINT generated by default as identity primary key,
    nick_name TEXT     NOT NULL,
    pet_type  SMALLINT NOT NULL,-- enum PetType
    color     SMALLINT NOT NULL,-- enum Color
    sex       SMALLINT NOT NULL -- enum Sex
);

DROP TABLE IF EXISTS adopters;
CREATE TABLE adopters
(
    id         BIGINT generated by default as identity primary key,
    user_id    BIGINT,
    animal_id  BIGINT NOT NULL,
    shelter_id BIGINT NOT NULL
);

DROP TABLE IF EXISTS shelters;
CREATE TABLE shelters
(
    id                 BIGINT generated by default as identity primary key,
    address_shelter    TEXT     NOT NULL,
    time_work          TEXT     NOT NULL,
    driving_directions TEXT     NOT NULL,
    phone_shelter      TEXT     NOT NULL,
    phone_security     TEXT     NOT NULL,
    shelter_type       SMALLINT NOT NULL -- enum ShelterType
);

-- changeset aleksey:2
DROP TABLE IF EXISTS reports;
CREATE TABLE reports
(
    id                    BIGINT generated by default as identity primary key,
    user_id               BIGINT    NOT NULL,
    date_report           TIMESTAMP NOT NULL,
    status_report         SMALLINT  NOT NULL, -- enum StatusReport
    date_end_of_probation TIMESTAMP NOT NULL,
    link_picture          BYTEA
);

DROP TABLE IF EXISTS dialogs;
CREATE TABLE dialogs
(
    id           BIGINT generated by default as identity primary key,
    guest_id     BIGINT    NOT NULL,
    volunteer_id BIGINT    NOT NULL,
    text_message TEXT      NOT NULL,
    date_message TIMESTAMP NOT NULL
);

-- changeset aleksey:3

ALTER TABLE reports DROP COLUMN IF EXISTS date_report;
ALTER TABLE reports DROP COLUMN IF EXISTS date_end_of_probation;
ALTER TABLE reports ADD COLUMN IF NOT EXISTS date_report DATE;
ALTER TABLE reports ADD COLUMN IF NOT EXISTS date_end_of_probation DATE;
ALTER TABLE dialogs DROP COLUMN IF EXISTS date_message;
ALTER TABLE dialogs ADD COLUMN IF NOT EXISTS date_message DATE;

-- changeset aleksey:4

ALTER TABLE reports ADD COLUMN IF NOT EXISTS report_text TEXT;